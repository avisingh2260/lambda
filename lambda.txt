---
schemaVersion: "0.3"
description: "Terminate active EC2 instances one by one with a 10-minute interval"

parameters: {}

mainSteps:
  - name: "GetActiveInstances"
    action: "aws:executeAwsApi"
    inputs:
      Service: "EC2"
      Api: "describeInstances"
      Filters:
        - Name: "instance-state-name"
          Values:
            - "running"
    outputs:
      - Name: "InstanceId"
        Selector: "$.Reservations[*].Instances[*].InstanceId"

  - name: "TerminateInstance"
    action: "aws:executeAwsApi"
    maxAttempts: 1
    inputs:
      Service: "EC2"
      Api: "terminateInstances"
      InstanceIds:
        - "{{ GetActiveInstances.InstanceId }}"
    waitTime: 600